openapi: 3.0.2
info:
  version: 'v1'
  title: '${project.name}'
  description: |
    ${project.description}
  license:
    name: '${license.name}'
    url: '${license.url}'
servers:
  #  /api must match servlet-mapping in web.xml
  - url: '/${project.artifactId}/v1'
    description: 'Version 1'

paths:

  # The ping service should be in all projects, should not do any advanced processing
  # and should respond quickly with a simple message, e.g. "pong".
  #
  # Note that it is placed under /monitor. The top namespace /monitor is intended for
  # proxying to monitoring software or manual health checks. All endpoints under that
  # namespace should be safe to expose: No changes to state, no confidential information!
  #
  # Note that the more detailed /monitor/status is defined below.
  /monitor/ping:
    get:
      tags:
        - '${project.name}'
      summary: 'Ping the server to check if the server is reachable.'
      operationId: ping
      x-useGenericResponse: false # If enabled the method will return Response
      x-streamingOutput: false # If enabled the method will return StreamingOutput.
      responses:
        '200':
          description: 'OK'
          content:
            text/plain:
              schema:
                type: string
        '406':
          description: 'Not Acceptable'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: 'Internal Error'
          content:
            text/plain:
              schema:
                type: string

  # The status service should be in all projects and should provide a list of running jobs,
  # the overall health of the service and similar. While the endpoint should be kept at
  # /monitor/status, the response should be adjusted to fit the application.
  #
  # Note that it is placed under /monitor. The top namespace /monitor is intended for
  # proxying to monitoring software or manual health checks. All endpoints under that
  # namespace should be safe to expose: No changes to state, no confidential information!
  #
  # Note that the simple /monitor/ping is defined above.
  /monitor/status:
    get:
      tags:
        - '${project.name}'
      summary: 'Detailed status / health check for the service'
      operationId: status
      responses:
        '200':
          description: 'OK'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Status'
        '500':
          description: 'Internal Error'
          content:
            text/plain:
              schema:
                type: string

  /solr/{collection}/select:
    get:
      tags:
        - '${project.name}'
      summary: 'Perform a Solr-compatible search in the stated collection'
      operationId: solrSearch
      parameters:
        - name: collection
          in: path
          description: 'The ID of the Solr collection to search. Available collections can be requested from /solr/admin/collections'
          required: true
          schema:
            type: string
            default: 'ds'
            example: 'ds'
        - name: q
          in: query
          description: 'Solr query param [https://solr.apache.org/guide/8_10/the-standard-query-parser.html#standard-query-parser-parameters](q)'
          required: true
          schema:
            type: string
            default: '*:*'
            example: '*:*'
      responses:
        '200':
          description: 'JSON structure with Solr response'
          content:
            application/json:
              schema:
                description: |
                  Output compatible with [Solr JSON response](https://solr.apache.org/guide/8_10/response-writers.html#json-response-writer)
                type: string

  /solr/admin/collections:
    get:
      tags:
        - '${project.name}'
      summary: 'Solr [Collection Management Commands](https://solr.apache.org/guide/8_10/collection-management.html)'
      operationId: collectionAction
      parameters:
        - name: action
          in: query
          description: | 
            Collection-action to perform. Note that some actions require high-level permissions:
            * [LIST](https://solr.apache.org/guide/8_10/collection-management.html#list)
            * [DELETE](https://solr.apache.org/guide/8_10/collection-management.html#delete)
          required: true
          schema:
            type: string
            enum:  ['LIST', 'DELETE']
            example: 'LIST'
            default: 'LIST'
        - name: name
          in: query
          description: | 
            Mandatory for the action [DELETE](https://solr.apache.org/guide/8_10/collection-management.html#delete)
            The name of the collection to delete.
          required: false
          schema:
            type: string
            example: 'ds'
        - name: async
          in: query
          description: | 
            Optional for the action [DELETE](https://solr.apache.org/guide/8_10/collection-management.html#delete)
            Request ID to track this action which will be processed asynchronously.
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 'JSON structure with Solr collection action response'
          content:
            application/json:
              schema:
                type: string

  /solr/admin/configs:
    get:
      tags:
        - '${project.name}'
      summary: 'Solr [Configsets Commands](https://solr.apache.org/guide/8_10/configsets-api.html)'
      operationId: configAction
      parameters:
        - name: action
          in: query
          description: | 
            Configset-action to perform. Note that some actions require high-level permissions:
            * [LIST](https://solr.apache.org/guide/8_10/configsets-api.html#configsets-list)
            * [DELETE](https://solr.apache.org/guide/8_10/configsets-api.html#configsets-delete)
          required: true
          schema:
            type: string
            enum:  ['LIST', 'DELETE']
            example: 'LIST'
            default: 'LIST'
        - name: name
          in: query
          description: | 
            Mandatory for the action [DELETE](https://solr.apache.org/guide/8_10/configsets-api.html#configsets-delete)
            The name of the configset to delete.
          required: false
          schema:
            type: string
            example: 'ds-conf'
      responses:
        '200':
          description: 'JSON structure with Solr configset action response'
          content:
            application/json:
              schema:
                type: string

components:
  schemas:

    # Sample status component. Adjust this to provide application specific status
    # such as a list of running jobs or free disk space
    Status:
      type: object
      required:
        - application
        - version
      properties:
        application:
          type: string
          description: 'The name of the application'
          example: 'MyService'
        version:
          type: string
          description: 'The version of the application'
          example: '1.2.3'
        build:
          type: string
          description: 'When the application was build'
          example: '2022-04-21T13:37:16Z'
        java:
          type: string
          description: 'The Java version that runs the container'
          example: '11.0.11'
        heap:
          type: integer
          format: int64
          description: 'The maximum number of bytes available to the container in megabytes'
          example: '4096'
        server:
          type: string
          description: 'The hostname for the server'
          example: 'miaplacidus'
        health:
          type: string
          description: 'Self diagnosed health'
          example: 'ok'

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
